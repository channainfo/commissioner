<%= render partial: 'spree/admin/shared/error_messages', locals: { target: @product } %>
<% content_for :page_title do %>
  <%= link_to Spree.t(:products), spree.admin_products_url %> /
  <%= Spree.t(:new_product) %>
<% end %>
<div class="card">
  <div class="card-body">
    <%= form_with model: @object, url: { action: 'create' } do |f| %>
      <fieldset data-hook="new_product">
        <%= f.field_container :name do %>
          <%= f.label :name, raw(Spree.t(:name) + required_span_tag) %>
          <%= f.text_field :name, class: 'form-control title', required: :required %>
          <%= f.error_message_on :name %>
        <% end %>
        <div data-hook="new_product_attrs" class="row">
          <% unless @product.has_variants? %>
            <div data-hook="new_product_sku" class="col-12 col-md-4">
              <%= f.field_container :sku do %>
                <%= f.label :sku, Spree.t(:sku) %>
                <%= f.text_field :sku, size: 16, class: 'form-control' %>
                <%= f.error_message_on :sku %>
              <% end %>
            </div>
          <% end %>
          <div data-hook="new_product_price" class="col-12 col-md-4">
            <%= f.field_container :price do %>
              <%= f.label :price, raw(Spree.t(:master_price) + required_span_tag) %>
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text"><%= currency_symbol(current_currency) %></span>
                </div>
                <%= f.text_field :price, value: number_to_currency(@product.price, unit: ''), class: 'form-control', required: :required %>
              </div>
              <%= f.error_message_on :price %>
            <% end %>
          </div>
          <% if current_spree_user.respond_to?(:has_spree_role?) && current_spree_user.has_spree_role?(:admin) %>
            <div data-hook="new_product_vendor" class="col-12 col-md-4">
              <%= f.field_container :vendor, class: ['form-group'] do %>
                <%= f.label :vendor_id, Spree.t(:vendor) %>
                <%= f.collection_select(:vendor_id, @vendors, :id, :name, { include_blank: Spree.t('match_choices.none') }, { class: 'select2' }) %>
                <%= f.error_message_on :vendor %>
              <% end %>
            </div>
          <% end %>
          <div>
            <%= f.hidden_field :status,value: 'active' %>
          </div>
          <div data-hook="new_product_shipping_category" class="col-4">
            <%= f.field_container :shipping_category do %>
              <%= f.label :shipping_category_id, raw(Spree.t(:shipping_categories) + required_span_tag) %>
              <%= f.collection_select(:shipping_category_id, @shipping_categories, :id, :name, { selected: @product.shipping_category_id }, { class: 'select2 w-100' }) %>
              <%= f.error_message_on :shipping_category_id %>
            <% end %>
          </div>
          <div data-hook="admin_product_form_taxons" class="col-4">
            <%= f.field_container :taxons do %>
              <%= f.label :taxon_ids, Spree.t(:taxons) %>
              <% if can? :modify, Spree::Classification %>
                <%= f.select :taxon_ids, options_from_collection_for_select(@product.taxons, :id, :pretty_name, @product.taxon_ids),
                                  { include_hidden: true },
                                    multiple: true,
                                    data: { autocomplete_url_value: 'taxons_api_v2',
                                            autocomplete_return_attr_value: 'pretty_name',
                                            autocomplete_multiple_value: true } %>
              <% elsif @product.taxons.any? %>
                <ul class="text_list">
                  <% @product.taxons.each do |taxon| %>
                    <li><%= taxon.name %></li>
                  <% end %>
                </ul>
              <% else %>
                <div class="alert alert-info"><%= Spree.t(:no_resource_found, resource: :taxons) %></div>
              <% end %>
            <% end %>
          </div>
          <% variant_kind_option_types = @product.variant_kind_option_types %>
          <div data-hook="admin_product_form_variant_kind_option_types" class="col-4" >
            <%= render 'shared/option_type_field',
              label: Spree.t(:option_types),
              select: :variant_kind_option_type_ids,
              option_types: variant_kind_option_types,
              kind: 'variant',
              f:f
            %>
          </div>
        </div>
        <div data-hook="new_product_subscribable" class="col-3">
          <span>
            <%= f.hidden_field :subscribable, value:true do %>
              <%= f.label :subscribable do %>
                <%= f.check_box :subscribable, checked: true %>
                <%= Spree.t(:subscribable) %>
              <% end %>
            <% end %>
          </span>
        </div>
        <div data-hook="product-from-prototype" id="product-from-prototype" class="col-3" >
          <% @prototype = @prototype || Spree::Prototype.new(option_types: []) %>
          <%= render template: 'spree/admin/prototypes/show' %>
        </div>
        <%= render partial: 'spree/admin/shared/new_resource_links' %>
      </fieldset>
    <% end %>
  </div>
</div>
